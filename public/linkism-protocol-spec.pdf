<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linkism Protocol Specification v1.0</title>
    <style>
        @page {
            size: A4;
            margin: 1in;
            @top-center {
                content: "Linkism Protocol Specification v1.0";
                font-size: 10pt;
                color: #666;
                border-bottom: 1px solid #ddd;
                padding-bottom: 8pt;
                margin-bottom: 20pt;
            }
            @bottom-center {
                content: counter(page);
                font-size: 10pt;
                color: #666;
            }
        }
        
        body {
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
            color: #333;
            max-width: none;
            margin: 0;
            padding: 0;
        }
        
        .cover {
            page-break-after: always;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 80vh;
        }
        
        .cover h1 {
            font-size: 28pt;
            margin-bottom: 20pt;
            color: #1a1a1a;
        }
        
        .cover .subtitle {
            font-size: 16pt;
            color: #666;
            margin-bottom: 40pt;
        }
        
        .cover .meta {
            font-size: 12pt;
            line-height: 2;
            margin-top: 40pt;
        }
        
        .toc {
            page-break-after: always;
        }
        
        .toc h2 {
            font-size: 18pt;
            border-bottom: 2px solid #333;
            padding-bottom: 8pt;
            margin-bottom: 20pt;
        }
        
        .toc ul {
            list-style: none;
            padding: 0;
        }
        
        .toc li {
            margin-bottom: 8pt;
            font-size: 11pt;
        }
        
        .toc .section-number {
            font-weight: bold;
            width: 30pt;
            display: inline-block;
        }
        
        h1 {
            font-size: 18pt;
            page-break-before: always;
            border-bottom: 2px solid #333;
            padding-bottom: 8pt;
            margin-bottom: 20pt;
            margin-top: 0;
        }
        
        h2 {
            font-size: 14pt;
            margin-top: 24pt;
            margin-bottom: 12pt;
            color: #1a1a1a;
        }
        
        h3 {
            font-size: 12pt;
            margin-top: 18pt;
            margin-bottom: 8pt;
            color: #333;
        }
        
        p {
            margin-bottom: 10pt;
            text-align: justify;
            font-size: 11pt;
        }
        
        ul, ol {
            margin-bottom: 12pt;
            padding-left: 20pt;
        }
        
        li {
            margin-bottom: 4pt;
            font-size: 11pt;
        }
        
        code {
            font-family: 'Courier New', monospace;
            background-color: #f5f5f5;
            padding: 2pt 4pt;
            font-size: 9pt;
            border: 1px solid #ddd;
        }
        
        pre {
            font-family: 'Courier New', monospace;
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            padding: 12pt;
            margin: 12pt 0;
            font-size: 9pt;
            white-space: pre-wrap;
            page-break-inside: avoid;
        }
        
        .example-box {
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            padding: 12pt;
            margin: 12pt 0;
            page-break-inside: avoid;
        }
        
        .note-box {
            border-left: 4px solid #4a90e2;
            background-color: #f0f8ff;
            padding: 12pt;
            margin: 12pt 0;
            page-break-inside: avoid;
        }
        
        .security-box {
            border-left: 4px solid #e74c3c;
            background-color: #fdf2f2;
            padding: 12pt;
            margin: 12pt 0;
            page-break-inside: avoid;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 12pt 0;
            font-size: 10pt;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8pt;
            text-align: left;
            vertical-align: top;
        }
        
        th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        
        .rfc-label {
            background-color: #e8f5e8;
            color: #2d5c2d;
            padding: 2pt 6pt;
            border-radius: 4pt;
            font-size: 9pt;
            font-weight: bold;
        }
        
        .status-stable {
            background-color: #e8f5e8;
            color: #2d5c2d;
        }
        
        .status-draft {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .appendix {
            page-break-before: always;
        }
        
        .page-break {
            page-break-before: always;
        }
    </style>
</head>
<body>
    <!-- Cover Page -->
    <div class="cover">
        <h1>Linkism Protocol Specification</h1>
        <div class="subtitle">Persistent UI Addressing Standard</div>
        <div class="meta">
            <div><strong>Version:</strong> 1.0</div>
            <div><strong>Date:</strong> August 2025</div>
            <div><strong>Author:</strong> Joel David Trout II</div>
            <div><strong>License:</strong> CC BY-SA 4.0</div>
            <div style="margin-top: 40pt; font-style: italic;">
                "A web where elements outlive frameworks"
            </div>
        </div>
    </div>

    <!-- Table of Contents -->
    <div class="toc">
        <h2>Table of Contents</h2>
        <ul>
            <li><span class="section-number">1.</span> Introduction</li>
            <li><span class="section-number">2.</span> Terminology</li>
            <li><span class="section-number">3.</span> LID URI Specification (RFC-001)</li>
            <li><span class="section-number">4.</span> SCR Bundle Format (RFC-002)</li>
            <li><span class="section-number">5.</span> Resolution Protocol (RFC-003)</li>
            <li><span class="section-number">6.</span> Best Current Practice (BCP-LID-001)</li>
            <li><span class="section-number">7.</span> Reference Implementation</li>
            <li><span class="section-number">8.</span> Quickstart Guide</li>
            <li><span class="section-number">9.</span> References</li>
        </ul>
    </div>

    <!-- 1. Introduction -->
    <h1>1. Introduction</h1>
    
    <p>Linkism defines a protocol for persistent element identity on the web. LIDs decouple tests, agents, and RPA from brittle DOM structure via immutable contracts, signed bundles, and offline resolution.</p>
    
    <p>This document consolidates the core LID URI specification (RFC-001) and deployment best practices (BCP-001) into a unified reference for implementers and adopters.</p>
    
    <p>Modern web applications suffer from brittle element selectors that break during UI changes. Linkism solves this by providing a standardized URI scheme for persistent element identification that survives framework migrations, redesigns, and time.</p>

    <h2>1.1 Protocol Architecture</h2>
    
    <div class="example-box">
        <strong>Protocol Flow:</strong><br/>
        HTML → contains → <code>lid://app.com/auth#login</code><br/>
        SCR Bundle → maps to → <code>button.primary</code><br/>
        Resolver → returns → CSS selector + confidence
    </div>

    <h2>1.2 Key Benefits</h2>
    <ul>
        <li><strong>Framework Independence:</strong> LIDs survive React → Vue → Angular migrations</li>
        <li><strong>Design System Resilience:</strong> UI redesigns don't break automation</li>
        <li><strong>Cryptographic Integrity:</strong> Signed bundles prevent selector tampering</li>
        <li><strong>Air-Gapped Resolution:</strong> Works without network dependencies</li>
    </ul>

    <!-- 2. Terminology -->
    <h1>2. Terminology</h1>
    
    <table>
        <tr>
            <th style="width: 120pt;">Term</th>
            <th>Definition</th>
        </tr>
        <tr>
            <td><code>LID</code></td>
            <td>Linkism ID - persistent identifier for UI elements</td>
        </tr>
        <tr>
            <td><code>Authority</code></td>
            <td>Domain name responsible for LID registration</td>
        </tr>
        <tr>
            <td><code>Path</code></td>
            <td>Hierarchical context for element grouping</td>
        </tr>
        <tr>
            <td><code>Fragment</code></td>
            <td>Specific element identifier</td>
        </tr>
        <tr>
            <td><code>SCR</code></td>
            <td>Selector Contract Registry - bundle format for LID contracts</td>
        </tr>
        <tr>
            <td><code>Resolver</code></td>
            <td>System translating LID to current selector</td>
        </tr>
    </table>

    <!-- 3. LID URI Specification -->
    <h1>3. LID URI Specification <span class="rfc-label status-stable">RFC-001</span></h1>
    
    <p>The LID URI scheme provides immutable addresses for UI elements that survive framework changes, redesigns, and time. Each LID consists of three components: authority (domain), path (context), and fragment (element identifier).</p>

    <h2>3.1 Core Syntax</h2>
    <pre>lid://authority/path#fragment
lid://app.com/checkout#submit-button
lid://docs.site.com/api/v2#search-input</pre>

    <h2>3.2 ABNF Specification</h2>
    <pre>lid-URI    = "lid://" authority path [ "#" fragment ]
authority  = domain-label *( "." domain-label )
domain-label  = alphanum [ [ldh] *( alphanum | "-" ) alphanum ]
path       = [ "/" path-segment *( "/" path-segment ) ]
path-segment = *( unreserved | pct-encoded | ":" | "@" )
fragment   = *( unreserved | pct-encoded | ":" | "@" | "/" | "?" )

unreserved  = ALPHA | DIGIT | "-" | "." | "_" | "~"
pct-encoded = "%" HEXDIG HEXDIG</pre>

    <h2>3.3 Character Encoding</h2>
    <ul>
        <li>UTF-8 encoding MUST be used throughout</li>
        <li>Domain names MUST be lowercase (IDN normalization applied)</li>
    </ul>
    <p>Reserved characters MUST be percent-encoded:</p>
    <ul>
        <li># → %23</li>
        <li>/ → %2F</li>
        <li>? → %3F</li>
    </ul>

    <h2>3.4 Resolution Semantics</h2>
    <p>Resolution follows this process:</p>
    <div class="example-box">
        LID URI → Parse Components → Verify Authority → Retrieve SCR Bundle → Locate Contract → Return Selector + Confidence
    </div>

    <h2>3.5 Key Properties</h2>
    <ul>
        <li><strong>Immutable:</strong> Authority, path, and fragment never change once registered</li>
        <li><strong>Hierarchical:</strong> Path provides contextual grouping</li>
        <li><strong>Verifiable:</strong> Optional cryptographic attestations for content integrity</li>
        <li><strong>Framework-agnostic:</strong> Works across React, Vue, Angular, etc.</li>
    </ul>

    <div class="note-box">
        <strong>Implementation Note:</strong> LIDs decouple test automation and UI tooling from brittle CSS selectors that break during redesigns.
    </div>

    <!-- 4. SCR Bundle Format -->
    <h1>4. SCR Bundle Format <span class="rfc-label status-stable">RFC-002</span></h1>
    
    <p>Selector Contract Registry (SCR) bundles are signed JSON documents that map LIDs to current CSS selectors. They enable offline resolution and provide cryptographic guarantees about element contracts.</p>

    <h2>4.1 Bundle Structure</h2>
    <pre>{
  "spec_version": "1.0",
  "manifest": {
    "authority": "app.com",
    "generated_at": "2025-01-01T00:00:00Z",
    "ttl_days": 365
  },
  "contracts": [
    {
      "lid": "lid://app.com/auth#login",
      "selector": "form#login > button.primary",
      "confidence": 1.0,
      "attestation": "sha256:9f86d08..."
    }
  ],
  "revocations": ["lid://app.com/legacy#submit"],
  "signature": {
    "algorithm": "ecdsa-p256",
    "payload": "MEYCI...",
    "chain": ["x509:org-root", "x509:team-issued"]
  }
}</pre>

    <h2>4.2 Required Fields</h2>
    
    <h3>4.2.1 manifest</h3>
    <ul>
        <li><strong>authority</strong> — domain that owns this bundle (must match LID authority)</li>
        <li><strong>generated_at</strong> — ISO 8601 UTC timestamp</li>
        <li><strong>ttl_days</strong> — time-to-live in days (after which bundle is expired)</li>
        <li><strong>scope</strong> — optional label for organizational grouping (e.g., "design-system")</li>
    </ul>

    <h3>4.2.2 contracts</h3>
    <p>Each contract MUST include:</p>
    <ul>
        <li><strong>lid</strong> — immutable LID address</li>
        <li><strong>selector</strong> — current valid CSS selector for the element</li>
        <li><strong>confidence</strong> — float between 0.0 and 1.0</li>
        <li><strong>attestation</strong> — optional sha256 hash of element content</li>
    </ul>

    <h2>4.3 Bundle Contents</h2>
    <ul>
        <li><strong>Contracts:</strong> LID → selector mappings with confidence scores</li>
        <li><strong>Manifest:</strong> Bundle metadata, TTL, and scope information</li>
        <li><strong>Signatures:</strong> Cryptographic verification chain</li>
        <li><strong>Revocations:</strong> Retired LIDs with optional successors</li>
    </ul>

    <div class="security-box">
        <strong>Security:</strong> All bundles must be cryptographically signed and verified before use in production environments.
    </div>

    <!-- 5. Resolution Protocol -->
    <h1>5. Resolution Protocol <span class="rfc-label status-draft">RFC-003</span></h1>
    
    <p>The Resolution Protocol defines how applications translate LIDs into current CSS selectors using SCR bundles. It supports both networked and air-gapped (offline) resolution workflows.</p>

    <h2>5.1 Resolution Flow</h2>
    <ol>
        <li>Parse LID URI → Extract authority, path, fragment</li>
        <li>Load SCR Bundle → Verify signature and TTL</li>
        <li>Lookup Contract → Find matching LID entry</li>
        <li>Return Result → Selector + confidence + metadata</li>
    </ol>

    <h2>5.2 Resolution Request</h2>
    <h3>Endpoint Details:</h3>
    <ul>
        <li><strong>Endpoint:</strong> <code>/v1/resolve-many</code></li>
        <li><strong>Method:</strong> <code>POST</code></li>
        <li><strong>Content-Type:</strong> <code>application/json</code></li>
    </ul>

    <h3>Request Schema</h3>
    <pre>{
  "lids": [
    "lid://app.com/checkout#submit",
    "lid://auth.app.com/login#continue"
  ],
  "bundle_fingerprint": "sha256:d6c7a4...",
  "options": {
    "strict": true,
    "fallback": false
  }
}</pre>

    <h2>5.3 Response Format</h2>
    <pre>{
  "lid://app.com/checkout#submit": {
    "selector": "button.checkout-final",
    "confidence": 0.95,
    "ttl": 43200,
    "attestation": "sha256:6b86b273..."
  },
  "lid://auth.app.com/login#continue": {
    "selector": "form#login .btn-continue",
    "confidence": 1.0,
    "ttl": 86400
  }
}</pre>

    <h2>5.4 Error Codes</h2>
    <table>
        <tr>
            <th>Status Code</th>
            <th>Meaning</th>
        </tr>
        <tr>
            <td><code>404</code></td>
            <td>LID not found in SCR bundle</td>
        </tr>
        <tr>
            <td><code>410</code></td>
            <td>LID explicitly retired</td>
        </tr>
        <tr>
            <td><code>423</code></td>
            <td>Bundle expired (TTL exceeded)</td>
        </tr>
        <tr>
            <td><code>498</code></td>
            <td>Invalid signature or fingerprint</td>
        </tr>
        <tr>
            <td><code>409</code></td>
            <td>Conflicting LIDs from multiple SCR</td>
        </tr>
    </table>

    <!-- 6. Best Current Practice -->
    <h1>6. Best Current Practice <span class="rfc-label">BCP-LID-001</span></h1>
    
    <h2>6.1 LID Naming Conventions</h2>
    
    <h3>6.1.1 Authority Selection</h3>
    <div class="example-box">
        <strong>✅ Do:</strong>
        <ul>
            <li>Use domains you control long-term (<code>lid://company.com</code>)</li>
            <li>Prefer subdomains for teams (<code>lid://team.company.com</code>)</li>
        </ul>
        <strong>❌ Avoid:</strong>
        <ul>
            <li>Ephemeral domains (<code>lid://staging-env-38.com</code>)</li>
            <li>IP addresses (<code>lid://192.168.1.1</code>)</li>
        </ul>
    </div>

    <h3>6.1.2 Path Design</h3>
    <ul>
        <li>Mirror URL structure: <code>lid://app.com/checkout/payment#submit</code></li>
        <li>Use @ for owned namespaces: <code>lid://app.com/@design-system/button#primary</code></li>
        <li>Avoid over-nesting (/page/section/component/subcomponent)</li>
        <li>Use versioned paths (/api/v2 vs. /api)</li>
    </ul>

    <h3>6.1.3 Fragment Semantics</h3>
    <ul>
        <li>Be specific but concise (#submit-order, not #btn)</li>
        <li>Include element type (#search-input, #avatar-image)</li>
        <li>Avoid PII (#user-email)</li>
        <li>Avoid transient states (#expanded)</li>
    </ul>

    <h2>6.2 SCR Bundle Hygiene</h2>
    
    <h3>6.2.1 Bundle Segmentation</h3>
    <ul>
        <li><strong>Small Apps:</strong> Single bundle</li>
        <li><strong>Large Apps:</strong> Split by team/domain</li>
    </ul>

    <h3>6.2.2 TTL Policies</h3>
    <table>
        <tr>
            <th>Bundle Type</th>
            <th>Recommended TTL</th>
        </tr>
        <tr>
            <td>Design Systems</td>
            <td>365 days</td>
        </tr>
        <tr>
            <td>Checkout Flows</td>
            <td>90 days</td>
        </tr>
        <tr>
            <td>A/B Test Variants</td>
            <td>30 days</td>
        </tr>
    </table>

    <h2>6.3 Security & Privacy</h2>
    
    <h3>6.3.1 Attestation Practices</h3>
    <ul>
        <li><strong>Critical Elements:</strong> Always hash content</li>
        <li><strong>Non-Critical:</strong> Skip hashing for performance</li>
    </ul>
    <pre>lid://bank.com/transfer#amount::sha256:6b86b2...</pre>

    <h3>6.3.2 Key Rotation</h3>
    <ol>
        <li>Generate new keys annually</li>
        <li>Publish old keys in <code>_linkism-revoked</code> DNS TXT</li>
    </ol>

    <h2>6.4 Examples</h2>
    
    <h3>6.4.1 Good LIDs</h3>
    <pre>lid://shop.com/checkout#apply-promo
lid://design.acme.com/@ds3/button#primary
lid://gov.uk/tax-form#error-ssn::sha256:...</pre>

    <h3>6.4.2 LIDs to Avoid</h3>
    <pre>lid://temp.com/modal#close          // Ephemeral authority
lid://app.com/#main-button           // No path context
lid://health.com/patients#diabetes   // PII in fragment</pre>

    <!-- 7. Reference Implementation -->
    <h1>7. Reference Implementation</h1>
    
    <p>A complete reference implementation in Rust that demonstrates LID parsing, SCR bundle verification, and resolution. Designed for readability and specification compliance rather than production optimization.</p>

    <h2>7.1 Key Features</h2>
    <ul>
        <li><strong>Zero Dependencies:</strong> Pure functions with no external requirements</li>
        <li><strong>WASM Compatible:</strong> Runs in browsers, servers, and embedded systems</li>
        <li><strong>Crypto-First:</strong> Built-in signature verification and attestation</li>
        <li><strong>Test Coverage:</strong> Comprehensive test suite for all edge cases</li>
    </ul>

    <h2>7.2 Core Structures</h2>
    <pre>/// LID URI representation (RFC-001 §3)
#[derive(Debug, Clone, PartialEq, Eq, Serialize, Deserialize)]
pub struct Lid {
    authority: String,
    path: String,
    fragment: String,
    attestation: Option&lt;String&gt;,
}</pre>

    <h2>7.3 Quick Start</h2>
    <pre>// Parse and resolve a LID
let lid = Lid::parse("lid://app.com/auth#login")?;
let result = bundle.resolve(&lid)?;
println!("Selector: {}", result.selector);</pre>

    <div class="note-box">
        <strong>Note:</strong> This is a reference implementation. Production systems should use established cryptographic libraries for signature verification.
    </div>

    <!-- 8. Quickstart Guide -->
    <h1>8. Quickstart Guide</h1>
    
    <h2>8.1 Bundle Generation</h2>
    <pre># Generate bundle from existing selectors (migration mode)
linkism bundle \
  --lid lid://app.com/auth#login \
  --selector 'form#login > button.primary' \
  --key ./team-key.pem \
  --output auth.scr

# Batch generation from URL crawl
linkism bundle --url https://app.com --out app.scr</pre>

    <h2>8.2 Resolution</h2>
    <pre># Resolve offline
linkism resolve \
  --lid lid://app.com/checkout#submit \
  --scr ./app.scr

# Validate bundle integrity
linkism verify-scr app.scr --trust-ring ./keys.pub</pre>

    <h2>8.3 Integration Examples</h2>
    
    <h3>8.3.1 Cypress</h3>
    <pre>// cypress/support/commands.js
Cypress.Commands.add('getLID', (lid) => {
  return cy.window().then((win) => {
    return win.linkismResolve(lid).then(result => {
      return cy.get(result.selector, { timeout: result.ttl * 1000 });
    });
  });
});

// Usage in tests
cy.getLID('lid://app.com/auth#login').click();</pre>

    <h3>8.3.2 Playwright</h3>
    <pre>// playwright.config.js
export default {
  use: {
    // Auto-resolve LIDs to selectors
    lidResolver: 'https://api.linkism.org/v1'
  }
};

// Usage in tests
await page.lid('lid://app.com/checkout#submit').click();</pre>

    <!-- 9. References -->
    <h1>9. References</h1>
    
    <h2>9.1 Normative References</h2>
    <table>
        <tr>
            <td><strong>[RFC3986]</strong></td>
            <td>Berners-Lee, T., "Uniform Resource Identifier (URI): Generic Syntax", STD 66, RFC 3986, January 2005.</td>
        </tr>
        <tr>
            <td><strong>[RFC7519]</strong></td>
            <td>Jones, M., Bradley, J., and N. Sakimura, "JSON Web Token (JWT)", RFC 7519, May 2015.</td>
        </tr>
        <tr>
            <td><strong>[RFC5280]</strong></td>
            <td>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, "Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile", RFC 5280, May 2008.</td>
        </tr>
    </table>

    <h2>9.2 Informational References</h2>
    <table>
        <tr>
            <td><strong>[BCP-LID-001]</strong></td>
            <td>Trout, J., "Deployment Guidelines for LID Infrastructure", BCP-LID-001, August 2025.</td>
        </tr>
        <tr>
            <td><strong>[LINKISM-IMPL]</strong></td>
            <td>Linkism Protocol Foundation, "Reference Implementation in Rust", August 2025.</td>
        </tr>
    </table>

    <!-- Footer -->
    <div style="page-break-before: always; text-align: center; margin-top: 100pt; color: #666; font-size: 10pt;">
        <p>© 2025 Linkism Protocol Foundation</p>
        <p>Licensed under CC BY-SA 4.0</p>
        <p>Open specification, royalty-free implementation</p>
        <div style="margin-top: 20pt; font-style: italic;">
            "A web where elements outlive frameworks"
        </div>
    </div>
</body>
</html>
